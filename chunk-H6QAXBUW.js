import{a as X}from"./chunk-O4GXS3LH.js";import{a as y}from"./chunk-KZIHZ4Z5.js";import{a as W}from"./chunk-FW2S2ADK.js";import{a as j,b as q,c as Q,d as K,e as v,f as U,h as Z,k as $,l as J}from"./chunk-LTMNDUKR.js";import{a as Y}from"./chunk-I6G6X6ZJ.js";import{a as L}from"./chunk-2I56YRRQ.js";import"./chunk-WWYCEHUS.js";import{c as z}from"./chunk-QZTPQHYX.js";import"./chunk-LYWNF2LM.js";import{e as k,h as O,l as H,n as B,q as G,s as P}from"./chunk-ED5CQGEH.js";import{p as w}from"./chunk-P35S44TO.js";import"./chunk-77TY73XB.js";import"./chunk-VHJX2WMS.js";import"./chunk-W4BNGQYG.js";import{Bc as h,Dc as M,Oc as A,Vb as s,Wb as a,Xb as i,Xc as N,Yb as f,dc as C,ed as I,fd as V,gb as g,gd as F,ja as c,lc as u,nc as _,pa as m,qa as p,ub as D,uc as x,vc as E,wc as T,za as r,zb as b}from"./chunk-TOUJTCCI.js";var S=class o{formData=r(null);updateItem=V();added=I();updated=I();formBuilder=c(G);global=c(w);roleService=c(y);constructor(){}ngOnInit(){this.initForm()}initForm(){let t=this.updateItem(),e=this.formBuilder.group({name:[t?.name||null,k.required]});this.formData.set(e)}onSubmit(){if(this.formData()?.invalid){console.log("submit"),this.formData()?.markAllAsTouched();return}console.log(this.formData()?.value),this.addRole()}async addRole(){try{this.global.showSpinner();let t="added",e;this.updateItem()?(t="updated",e=await this.roleService.updateRole(this.updateItem().id,this.formData()?.value),this.updated.emit(e)):(e=await this.roleService.addRole(this.formData()?.value),this.added.emit(e)),console.log(e),this.global.showSuccess(`Role ${t} successfully`,null,5e3,!1,"increasing","toast-top-center"),this.global.hideModal()}catch(t){console.log(t),this.global.showAlert("Error!",t,"OK")}finally{this.global.hideSpinner()}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-add-role"]],inputs:{updateItem:[1,"updateItem"]},outputs:{added:"added",updated:"updated"},decls:6,vars:3,consts:[[3,"ngSubmit","formGroup"],[1,"row","g-4","mb-6","mx-4"],[1,"col-xl-12","col-sm-12","col-12"],["label","NAME","placeholder","Name","icon","user",3,"required","control"],[1,"box-footer","mt-4","d-flex","justify-content-center"]],template:function(e,n){if(e&1){let l=C();a(0,"form",0),u("ngSubmit",function(){return m(l),p(n.onSubmit())}),a(1,"div",1)(2,"div",2),f(3,"app-input-form",3),i(),a(4,"div",4),f(5,"app-submit-button"),i()()()}if(e&2){let l=n.formData();s("formGroup",l),g(3),s("required",!0)("control",l.controls.name)}},dependencies:[P,H,O,B,L,z],encapsulation:2})};var ne=()=>["id","name","created_at","updated_at"];function ae(o,t){o&1&&(a(0,"span",15),h(1,"NAME"),i())}function ie(o,t){if(o&1&&h(0),o&2){let e=t.row;M(" ",e==null?null:e.name," ")}}function le(o,t){o&1&&(a(0,"span",15),h(1,"CREATED AT"),i())}function re(o,t){if(o&1&&f(0,"app-datepipe-text-format",16),o&2){let e=t.value;s("value",e)}}function se(o,t){o&1&&(a(0,"span",15),h(1,"UPDATED AT"),i())}function de(o,t){if(o&1&&f(0,"app-datepipe-text-format",16),o&2){let e=t.value;s("value",e)}}function me(o,t){o&1&&(a(0,"span",15),h(1,"ACTION"),i())}function pe(o,t){if(o&1){let e=C();a(0,"app-icon-round-button",17),u("onClick",function(){let l=m(e).row,d=_(),R=T(21);return p(d.editItem(l,R))}),i(),a(1,"app-icon-round-button",18),u("onClick",function(){let l=m(e).row,d=_();return p(d.deleteItemAlert(l))}),i()}}function ue(o,t){if(o&1){let e=C();a(0,"div",19)(1,"h4",20),h(2,"ADD ROLE"),i(),a(3,"button",21),u("click",function(){m(e);let l=_();return p(l.global.hideModal())}),i()(),a(4,"div",22)(5,"app-add-role",23),u("added",function(l){m(e);let d=_();return p(d.addData(l))})("updated",function(l){m(e);let d=_();return p(d.updateData(l))}),i()()}if(o&2){let e=_();g(5),s("updateItem",e.updateItem())}}var ee=class o{table=F(v);ColumnMode=K;title="ROLES";roles=r([]);loadingIndicator=r(!1);updateItem=r(null);totalRecords=r(0);currentPage=r(0);pageSize=r(J.PAGE_SIZE);sortField=r("id");sortOrder=r("asc");filterText=r("");global=c(w);roleService=c(y);constructor(){}ngOnInit(){this.loadData()}setRoles(t){this.roles.set(t)}setLoadingIndicator(t){this.loadingIndicator.set(t)}updateTotalRecords(t){this.totalRecords.update(e=>e+t)}async loadData(){this.setLoadingIndicator(!0);try{let t={page:this.currentPage()+1,size:this.pageSize(),sortField:this.sortField(),sortOrder:this.sortOrder(),filter:this.filterText()};this.global.showSpinner();let e=await this.roleService.getRoles(t);console.log(e),this.setRoles(e?.data),this.totalRecords.set(e?.pagination?.total)}catch(t){console.log(t),this.global.showErrorMessage(t,null,3e3,!1,"decreasing","toast-top-center")}finally{this.setLoadingIndicator(!1),this.global.hideSpinner()}}onPageChange(t){console.log(t),this.currentPage.set(t.offset),this.loadData()}onSortChange(t){let e=t.sorts[0];e?.prop&&(this.sortField.set(e.prop),this.sortOrder.set(e.dir),this.loadData())}onFilterChange(t){this.filterText.set(t),this.loadData()}async openAddModal(t,e=!1){e||this.updateItem.set(null),this.global.showModal(t)}async deleteItemAlert(t){console.log(t);let e=await this.global.showAlert("Are you sure?","You want to delete this role! Deleting role will also delete related Users","YES",!1,"NO","question");e.isConfirmed?this.deleteItem(t):(e.dismiss,this.global.cancelSwal())}addData(t){this.roles.update(e=>[...e,t]),this.updateTotalRecords(1)}updateData(t){this.roles.update(e=>e.map(n=>n.id===t.id?t:n))}deleteData(t){this.roles.update(e=>e.filter(n=>n.id!==t)),this.updateTotalRecords(-1)}async deleteItem(t){try{this.global.showSpinner();let e=await this.roleService.deleteRole(t?.id);console.log(e),this.deleteData(t?.id),this.global.showSuccess("Role deleted successfully",null,5e3,!1,"increasing","toast-top-center")}catch(e){console.log(e),this.global.showAlert("Error!",e,"OK")}finally{this.global.hideSpinner()}}editItem(t,e){this.updateItem.set(t),this.openAddModal(e,!0)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-roles"]],viewQuery:function(e,n){e&1&&x(n.table,v,5),e&2&&E()},decls:22,vars:17,consts:[["table",""],["addRoleTemplate",""],["buttonLabel","Add Role",3,"onButtonClick","title","subRoute","lastRoute"],[1,"table-wrapper","rounded"],[1,"d-flex","align-items-center","justify-content-end"],[1,"search-table-input",3,"filteredData"],["api","getRoles",3,"fileName","values","fields"],[1,"col-md-12","mb-3"],[1,"material",3,"columnMode","headerHeight","footerHeight","rowHeight","loadingIndicator","scrollbarH","reorderable","limit","rows"],["prop","name"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["prop","created_at"],["prop","updated_at"],[3,"frozenRight"],[1,"tableHeader"],[3,"value"],["icon","fa fa-edit","addIconClass","edit","tooltip","Edit",3,"onClick"],["icon","fa fa-trash","addIconClass","delete","tooltip","Delete",3,"onClick"],[1,"modal-header","d-flex","justify-content-between","align-items-center"],[1,"modal-title","mb-0"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[3,"added","updated","updateItem"]],template:function(e,n){if(e&1){let l=C();a(0,"app-content-header",2),u("onButtonClick",function(){m(l);let R=T(21);return p(n.openAddModal(R))}),i(),a(1,"div",3)(2,"div",4)(3,"app-search-filter-input",5),u("filteredData",function(R){return m(l),p(n.onFilterChange(R))}),i(),f(4,"app-excel-button",6),i(),a(5,"div",7)(6,"ngx-datatable",8,0)(8,"ngx-datatable-column",9),b(9,ae,2,0,"ng-template",10)(10,ie,1,1,"ng-template",11),i(),a(11,"ngx-datatable-column",12),b(12,le,2,0,"ng-template",10)(13,re,1,1,"ng-template",11),i(),a(14,"ngx-datatable-column",13),b(15,se,2,0,"ng-template",10)(16,de,1,1,"ng-template",11),i(),a(17,"ngx-datatable-column",14),b(18,me,2,0,"ng-template",10)(19,pe,2,0,"ng-template",11),i()()()(),b(20,ue,6,1,"ng-template",null,1,N)}e&2&&(s("title",n.title)("subRoute",n.title)("lastRoute",!1),g(4),s("fileName",n.title)("values",n.roles())("fields",A(16,ne)),g(2),s("columnMode",n.ColumnMode.force)("headerHeight",50)("footerHeight",50)("rowHeight","auto")("loadingIndicator",n.loadingIndicator())("scrollbarH",!0)("reorderable",!0)("limit",10)("rows",n.roles()),g(11),s("frozenRight",!0))},dependencies:[Y,U,v,Q,j,q,S,X,$,Z,W],encapsulation:2})};export{ee as RolesComponent};
