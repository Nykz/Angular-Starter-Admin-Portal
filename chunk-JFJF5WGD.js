import{a as Z}from"./chunk-ZQNEKBBO.js";import{a as Y}from"./chunk-KZIHZ4Z5.js";import{a as X}from"./chunk-OCQ4ZSDD.js";import{a as L,b as j,c as G,d as Q,e as x,f as q,h as $,k as J,l as W}from"./chunk-TPZHGZ4G.js";import{a as K}from"./chunk-I6G6X6ZJ.js";import{a as B}from"./chunk-WONNLM5S.js";import{a as z}from"./chunk-SJDQVZ4T.js";import{p as F}from"./chunk-P35S44TO.js";import{U as H}from"./chunk-VHJX2WMS.js";import{Bc as s,Cc as A,Dc as b,Oc as V,Pb as U,Pc as N,Qb as D,Vb as _,Wb as a,Xb as i,Xc as k,Yb as S,a as v,cb as y,dc as C,fd as P,gb as g,gd as O,ja as w,lc as f,nc as c,pa as p,qa as d,ub as I,uc as E,vc as M,wc as T,xc as R,za as m,zb as h}from"./chunk-TOUJTCCI.js";var te=n=>({"table-wrapper rounded":n}),ne=()=>["id","name","role_id","role.name","phone","email","account_status"];function oe(n,t){if(n&1){let e=C();a(0,"app-content-header",17),f("onButtonClick",function(){p(e);let r=c(),l=T(27);return d(r.openAddModal(l))}),i()}if(n&2){let e=c();_("title",e.title)("subRoute",e.title)("lastRoute",!1)}}function ae(n,t){n&1&&(a(0,"span",18),s(1,"PHOTO"),i())}function ie(n,t){if(n&1&&S(0,"img",19),n&2){let e=t.value,o=c();_("src",e||o.avatar,y)}}function re(n,t){n&1&&(a(0,"span",18),s(1,"NAME"),i())}function le(n,t){if(n&1&&(s(0),a(1,"div")(2,"span",20),s(3),i()()),n&2){let e=t.row;b(" ",e==null?null:e.name," ");let o=e==null?null:e.role_id,r=o===1?"var(--primary-color)":o===2?"var(--secondary-color)":"var(--tertiary-color)";g(2),R("background-color",r),g(),A(e==null||e.role==null?null:e.role.name)}}function se(n,t){n&1&&(a(0,"span",18),s(1,"ACCOUNT STATUS"),i())}function pe(n,t){if(n&1){let e=C();a(0,"app-toggle-button",21),f("checkedChange",function(r){let l=p(e).row,u=c();return d(u.onStatusChange(r,l))}),i()}if(n&2){let e=t.row;_("checked",e.account_status)}}function de(n,t){n&1&&(a(0,"span",18),s(1,"EMAIL"),i())}function me(n,t){if(n&1&&s(0),n&2){let e=t.value;b(" ",e," ")}}function ce(n,t){n&1&&(a(0,"span",18),s(1,"PHONE"),i())}function ue(n,t){if(n&1&&s(0),n&2){let e=t.value;b(" ",e," ")}}function ge(n,t){n&1&&(a(0,"span",18),s(1,"ACTION"),i())}function _e(n,t){if(n&1){let e=C();a(0,"app-icon-round-button",22),f("onClick",function(){let r=p(e).row,l=c(),u=T(27);return d(l.editItem(r,u))}),i(),a(1,"app-icon-round-button",23),f("onClick",function(){let r=p(e).row,l=c();return d(l.deleteItemAlert(r))}),i()}}function fe(n,t){if(n&1){let e=C();a(0,"div",24)(1,"h4",25),s(2),i(),a(3,"button",26),f("click",function(){p(e);let r=c();return d(r.global.hideModal())}),i()(),a(4,"div",27)(5,"app-add-user",28),f("added",function(r){p(e);let l=c();return d(l.addData(r))})("updated",function(r){p(e);let l=c();return d(l.updateData(r))}),i()()}if(n&2){let e=c();g(2),b(" ",e.updateItem()?"EDIT":"ADD"," USER "),g(3),_("updateItem",e.updateItem())("roles",e.roles())}}var ee=class n{table=O(x);ColumnMode=Q;title="USERS";avatar="assets/imgs/avatar.png";users=m([]);loadingIndicator=m(!1);roles=m([]);updateItem=m(null);totalRecords=m(0);currentPage=m(0);pageSize=m(W.PAGE_SIZE);sortField=m("id");sortOrder=m("asc");filterText=m("");isCard=P(!1);global=w(F);userService=w(z);roleService=w(Y);constructor(){}ngOnInit(){this.loadData()}setUsers(t){this.users.set(t)}setLoadingIndicator(t){this.loadingIndicator.set(t)}updateTotalRecords(t){this.totalRecords.update(e=>e+t)}async loadData(){this.setLoadingIndicator(!0);try{let t={page:this.currentPage()+1,size:this.pageSize(),sortField:this.sortField(),sortOrder:this.sortOrder(),filter:this.filterText()};this.global.showSpinner();let e=await this.userService.getUsers(t);console.log(e),this.setUsers(e?.data),this.totalRecords.set(e?.pagination?.total)}catch(t){console.log(t),this.global.showErrorMessage(t,null,3e3,!1,"decreasing","toast-top-center")}finally{this.setLoadingIndicator(!1),this.global.hideSpinner()}}onPageChange(t){console.log(t),this.currentPage.set(t.offset),this.loadData()}onSortChange(t){let e=t.sorts[0];e?.prop&&(this.sortField.set(e.prop),this.sortOrder.set(e.dir),this.loadData())}onFilterChange(t){this.filterText.set(t),this.loadData()}async openAddModal(t,e=!1){e||this.updateItem.set(null),this.roles()?.length===0&&await this.getRoles(),this.global.showModal(t)}async getRoles(){try{this.global.showSpinner();let t=await this.roleService.getAllRoles();console.log(t),this.roles.set(t)}catch(t){console.log(t),this.global.showErrorMessage("Error! Please check & try again...",null,3e3,!1,"decreasing","toast-top-center")}finally{this.global.hideSpinner()}}async deleteItemAlert(t){console.log(t);let e=await this.global.showAlert("Are you sure?","You want to delete this user!","YES",!1,"NO","question");e.isConfirmed?this.deleteItem(t):(e.dismiss,this.global.cancelSwal())}addData(t){this.users.update(e=>[...e,t]),this.updateTotalRecords(1)}updateData(t){this.users.update(e=>e.map(o=>o.id===t.id?t:o))}deleteData(t){this.users.update(e=>e.filter(o=>o.id!==t)),this.updateTotalRecords(-1)}async deleteItem(t){try{this.global.showSpinner();let e=await this.userService.deleteUser(t?.id);console.log(e),this.deleteData(t?.id),this.global.showSuccess("Account deleted successfully",null,5e3,!1,"increasing","toast-top-center")}catch(e){console.log(e),this.global.showAlert("Error!",e,"OK")}finally{this.global.hideSpinner()}}editItem(t,e){this.updateItem.set(t),this.openAddModal(e,!0)}async onStatusChange(t,e){console.log(t);try{this.global.showSpinner();let o=await this.userService.updateUser(e?.id,{account_status:t});console.log(o),this.updateData(v(v({},e),o)),this.global.showSuccess(`Account status ${t?"activated":"deactivated"} successfully`,null,5e3,!1,"increasing","toast-top-center")}catch(o){console.log(o),this.global.showAlert("Error!",o,"OK")}finally{this.global.hideSpinner()}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-users"]],viewQuery:function(e,o){e&1&&E(o.table,x,5),e&2&&M()},inputs:{isCard:[1,"isCard"]},decls:28,vars:20,consts:[["table",""],["addUserTemplate",""],["buttonLabel","Add User",3,"title","subRoute","lastRoute"],[3,"ngClass"],[1,"d-flex","align-items-center","justify-content-end"],[1,"search-table-input",3,"filteredData"],["api","getUsers",3,"fileName","values","fields"],[1,"col-md-12","mb-3"],[1,"material",3,"page","sort","rows","columnMode","headerHeight","footerHeight","rowHeight","loadingIndicator","scrollbarH","externalPaging","limit","count","offset"],["prop","photo"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["prop","name"],["prop","account_status"],["prop","email"],["prop","phone"],[3,"frozenRight"],["buttonLabel","Add User",3,"onButtonClick","title","subRoute","lastRoute"],[1,"tableHeader"],[1,"avatar-image","rounded-circle",3,"src"],[1,"badge"],[3,"checkedChange","checked"],["icon","fa fa-edit","addIconClass","edit","tooltip","Edit",3,"onClick"],["icon","fa fa-trash","addIconClass","delete","tooltip","Delete",3,"onClick"],[1,"modal-header","d-flex","justify-content-between","align-items-center"],[1,"modal-title","mb-0","fw-bold"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[3,"added","updated","updateItem","roles"]],template:function(e,o){if(e&1){let r=C();U(0,oe,1,3,"app-content-header",2),a(1,"div",3)(2,"div",4)(3,"app-search-filter-input",5),f("filteredData",function(u){return p(r),d(o.onFilterChange(u))}),i(),S(4,"app-excel-button",6),i(),a(5,"div",7)(6,"ngx-datatable",8,0),f("page",function(u){return p(r),d(o.onPageChange(u))})("sort",function(u){return p(r),d(o.onSortChange(u))}),a(8,"ngx-datatable-column",9),h(9,ae,2,0,"ng-template",10)(10,ie,1,1,"ng-template",11),i(),a(11,"ngx-datatable-column",12),h(12,re,2,0,"ng-template",10)(13,le,4,4,"ng-template",11),i(),a(14,"ngx-datatable-column",13),h(15,se,2,0,"ng-template",10)(16,pe,1,1,"ng-template",11),i(),a(17,"ngx-datatable-column",14),h(18,de,2,0,"ng-template",10)(19,me,1,1,"ng-template",11),i(),a(20,"ngx-datatable-column",15),h(21,ce,2,0,"ng-template",10)(22,ue,1,1,"ng-template",11),i(),a(23,"ngx-datatable-column",16),h(24,ge,2,0,"ng-template",10)(25,_e,2,0,"ng-template",11),i()()()(),h(26,fe,6,3,"ng-template",null,1,k)}e&2&&(D(o.isCard()?-1:0),g(),_("ngClass",N(17,te,!o.isCard())),g(3),_("fileName",o.title)("values",o.users())("fields",V(19,ne)),g(2),_("rows",o.users())("columnMode",o.ColumnMode.force)("headerHeight",50)("footerHeight",50)("rowHeight","auto")("loadingIndicator",o.loadingIndicator())("scrollbarH",!0)("externalPaging",!0)("limit",o.pageSize())("count",o.totalRecords())("offset",o.currentPage()),g(17),_("frozenRight",!0))},dependencies:[K,q,x,G,L,j,B,Z,$,J,X,H],encapsulation:2})};export{ee as a};
